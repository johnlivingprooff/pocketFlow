id,title,severity,path_file_line,repro_command,root_cause,recommendation,acceptance_criteria,pr_link
1,Race condition in recurring transaction processing,HIGH,src/lib/services/recurringTransactionService.ts:8-52,Launch app multiple times rapidly or use app state transitions,processRecurringTransactions() is called without locking mechanism. Multiple simultaneous calls can create duplicate recurring instances when app returns from background or starts up,Add idempotency check before creating instances. Use UNIQUE constraint or check for existing transaction before insert,No duplicate recurring transactions created during rapid app state changes,
2,Silent failure in backup restore without transaction rollback,CRITICAL,src/lib/export/backupRestore.ts:105-179,Attempt to restore corrupted backup file,Restore operation uses sequential exec() calls without wrapping in database transaction. Partial restore leaves database in inconsistent state,Wrap entire restore operation in withTransactionAsync() to ensure atomicity. Add validation before starting restore,Failed restore rolls back completely leaving database unchanged. Add test for partial restore failure,
3,Cache invalidation race in rapid transaction writes,MEDIUM,src/lib/db/transactions.ts:22-37,Create 5+ transactions rapidly in sequence,invalidateTransactionCaches() is called synchronously after write but before client receives confirmation. Race between cache clear and subsequent read,Move cache invalidation inside database transaction or use event-based invalidation after commit confirmation,Cache always reflects committed state. No stale reads immediately after write,
4,Missing prepared statement cleanup in wallet reordering,MEDIUM,src/lib/db/wallets.ts:84-103,Reorder wallets 50+ times rapidly,Prepared statement created inside withTransactionAsync but cleanup happens in finally block. Exception before finalize leaks statement handle,Move prepared statement creation/finalization outside transaction or ensure finalize is called even on transaction failure,No statement leaks under stress. Monitor statement count during load test,
5,No file system full handling in receipt save,MEDIUM,src/lib/services/fileService.ts:16-35,Fill device storage then save receipt,saveReceiptImage throws generic error when disk is full. User sees 'Failed to save receipt image' without actionable guidance,Check available disk space before write. Provide specific error message for disk full scenario,User sees 'Storage full' error with option to free space or skip receipt,
6,Unbounded recurring transaction generation,HIGH,src/lib/services/recurringTransactionService.ts:37-80,Create daily recurring transaction with no end date and don't open app for 1 year,calculateMissingInstances generates all instances up to current date without limit. Could generate 365+ transactions at once,Add maximum instance generation limit (e.g. 100) per processing cycle. Generate older instances in batches over time,Maximum 100 instances generated per app startup even after long dormant period,
7,AsyncStorage persistence failures not handled,LOW,src/store/useStore.ts:47-66,Force AsyncStorage failure or simulate storage quota exceeded,Zustand persist middleware writes to AsyncStorage without error handling. Settings changes silently fail to persist,Add error boundary or fallback when AsyncStorage operations fail. Log warnings when persistence fails,User notified if settings cannot be saved. App continues functioning with in-memory state,
8,No idempotency for transfer operations,MEDIUM,src/lib/db/transactions.ts:89-138,Call transferBetweenWallets twice with same parameters,Transfer creates two paired transactions without checking for duplicates. Double submission creates duplicate transfers,Add unique constraint or idempotency key to prevent duplicate transfers. Use transaction_group_id to link paired transactions,Duplicate transfer requests within 5 seconds are detected and prevented,
9,Category lookup case sensitivity inconsistency,LOW,src/lib/db/categories.ts:72-85,Create category 'Food' then search for 'food',getCategoryByName is case-insensitive but some UI flows may do case-sensitive string comparison,Document case-insensitive behavior and ensure all category lookups use getCategoryByName,All category operations are case-insensitive consistently across app,
10,Missing database connection pool saturation handling,LOW,src/lib/db/index.ts:7-21,Open 50+ concurrent database operations,Single database connection shared globally. Very high concurrency could cause query queuing or timeouts,Add connection pool limits and queue depth monitoring. Consider read replicas for analytics,Database operations complete under high concurrency stress test,
11,No retry logic for transient database lock errors (RESOLVED),RESOLVED,src/lib/db/index.ts:34-43 src/lib/db/writeQueue.ts:1-175,"Execute concurrent writes, especially during wallet reorder + immediate transaction creation","SQLite SQLITE_BUSY errors cause immediate failure. No retry with exponential backoff. Write operations compete without serialization, causing lock conflicts in release builds.","FIXED: Implemented comprehensive locking prevention: 1) Enabled WAL mode + busy_timeout=5000ms for reduced contention 2) Created write queue (writeQueue.ts) that serializes all writes via FIFO queue 3) Added automatic retry with exponential backoff (50ms→100ms→200ms, max 3 attempts) 4) Wrapped all write operations (execRun, updateWalletsOrder, addTransactionsBatch, clearDatabase) in queue. See DATABASE_LOCKING_FIX.md for details.","No SQLITE_BUSY errors under concurrent load. Wallet reorder + immediate transaction succeeds. Stress test of 100 concurrent operations succeeds. Queue metrics show healthy operation.",copilot/debug-sqlite-locking-issue
12,Cache TTL not timezone-aware for date-based keys,LOW,src/lib/cache/queryCache.ts:222-237,Change device timezone while app is running,generateCacheKey for date-based queries uses local time. Cache keys mismatch after timezone change,Use UTC timestamps in cache keys or invalidate cache on timezone change detection,Cache correctly invalidates when timezone changes,
13,Biometric auth bypass on app state change race,MEDIUM,app/_layout.tsx:64-84,Background app during auth prompt then quickly foreground,handleAppStateChange can fire while performBiometricAuth is in progress. Race condition may skip auth,Add authentication state machine to prevent concurrent auth attempts. Lock state during auth,Authentication always required after configured timeout regardless of state change timing,
14,No batch size limit in addTransactionsBatch,LOW,src/lib/db/transactions.ts:44-79,Call addTransactionsBatch with 10000+ transactions,Batch operation has no size limit. Very large batches could cause memory pressure or long transaction times,Add batch size validation (e.g. max 1000). Split larger batches automatically,Large batch operations automatically chunked. Memory stable during 10k transaction import,
15,Query result JSON serialization not validated,LOW,src/lib/export/backupRestore.ts:19-61,Export data with circular references or non-serializable values,JSON.stringify could throw on certain data patterns. Error not caught gracefully,Validate serializable data before stringify. Use replacer function to handle edge cases,Export handles edge cases gracefully without crashing
16,Wallet reorder breaking subsequent writes (RESOLVED),RESOLVED,src/lib/db/wallets.ts:6-103,"Create wallets, reorder them, then try to create transactions/categories",display_order was not initialized on wallet creation causing all wallets to have value 0. Query used created_at DESC as secondary sort causing unpredictable ordering. This created UI/DB state mismatch that users perceived as write failures,Fix implemented: Initialize display_order on creation (line 11), remove secondary sort (line 76), enforce sequential values in reorder (line 95). Migration repairs existing data (src/lib/db/index.ts:80-102),"Wallet creation assigns sequential display_order, reorder persists correctly, subsequent operations work. Comprehensive test suite added (tests/wallet-reorder.test.ts), repair scripts available (repair-scripts/), monitoring documented (runbook.md)",copilot/fix-wallet-reorder-issue
